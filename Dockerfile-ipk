FROM itdoginfo/openwrt-sdk-ipk:24.10.3

ARG PARENTCONTROL_VERSION
ENV PARENTCONTROL_VERSION=${PARENTCONTROL_VERSION}

COPY . /builder/
COPY ./luci-app-parentcontrol /builder/package/feeds/luci/luci-app-parentcontrol

RUN echo "=== Checking file contents ===" && \
    echo "htdocs files:" && find /builder/package/feeds/luci/luci-app-parentcontrol/htdocs/ -type f -exec ls -la {} \; && \
    echo "root files:" && find /builder/package/feeds/luci/luci-app-parentcontrol/root/ -type f -exec ls -la {} \; && \
    echo "File sizes:" && find /builder/package/feeds/luci/luci-app-parentcontrol/ -name "*.js" -o -name "*.json" -o -name "parentalcontrol*" -exec ls -la {} \;

RUN make defconfig && \
    make package/luci-app-parentcontrol/compile V=s

RUN echo "=== Build result ===" && \
    find /builder/bin/packages/ -name "*parentcontrol*" -type f