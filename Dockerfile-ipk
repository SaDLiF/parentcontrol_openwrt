FROM itdoginfo/openwrt-sdk-ipk:24.10.3

ARG PARENTCONTROL_VERSION
ENV PARENTCONTROL_VERSION=${PARENTCONTROL_VERSION}

COPY . /builder/
COPY ./luci-app-parentcontrol /builder/package/feeds/luci/luci-app-parentcontrol

RUN echo "=== BUILD STARTED ===" && \
    echo "Version: $PARENTCONTROL_VERSION" && \
    echo "=== PACKAGE STRUCTURE ===" && \
    find /builder/package/feeds/luci/luci-app-parentcontrol/ -type f

RUN make defconfig

RUN echo "=== COMPILING PACKAGE ===" && \
    make package/luci-app-parentcontrol/compile V=s

RUN echo "=== BUILD FINISHED ===" && \
    echo "=== FINDING OUR PACKAGE ===" && \
    find /builder/bin/packages/ -name "*parentcontrol*" -type f && \
    echo "=== ALL IPK FILES ===" && \
    find /builder/bin/packages/ -name "*.ipk" -type f | head -20